<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мои задания</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', path='css/tutor-home.css') }}">
  <script src="{{ url_for('static', path='js/script.js') }}" defer></script>
</head>
<body class="body-base">
  <nav class="nav-base">
    <div class="nav-title">IPYNBGrader</div>
    <div class="nav-actions">
      <a href="/pages/tutor-home" class="home-link">Домой</a>
      <form id="logout-form">
        <button type="submit" class="logout-button">Выйти</button>
      </form>
    </div>
  </nav>

  <main class="main-container">
    <div class="main-header">
      <h1 class="main-title">Мои задания</h1>
      <a href="/pages/assignments" class="create-button">+ Новое задание</a>
    </div>

    <!-- Форма поиска и сортировки -->
    <form method="get" class="sort-form">
      <label for="sortSelect">Сортировка:</label>
      <select id="sortSelect" name="sort" onchange="this.form.submit()">
        <option value="newest" {% if sort | trim == 'newest' %}selected{% endif %}>Сначала новые</option>
        <option value="oldest" {% if sort | trim == 'oldest' %}selected{% endif %}>Сначала старые</option>
      </select>

      <input 
        type="text" 
        name="search" 
        placeholder="Поиск по названию..." 
        value="{{ search | default('') }}" 
        class="px-2 py-1 border rounded"
      >
      <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
        Найти
      </button>
    </form>

    <!-- Таблица заданий -->
    <table class="assignment-table mt-6">
      <thead>
        <tr class="table-header">
          <th class="table-cell">Название</th>
          <th class="table-cell">Дата открытия</th>
          <th class="table-cell">Дата сдачи</th>
          <th class="table-cell">Максимальный балл</th>
          <th class="table-cell">Статистика</th>
        </tr>
      </thead>
      <tbody>
        {% if assignments %}
          {% for a in assignments %}
          <tr class="table-row">
            <td class="table-cell">
              <a href="/pages/assignments/{{ a.id }}?page={{ current_page }}&sort={{ sort | trim }}&search={{ search }}" 
                class="assignment-link">{{ a.name }}</a>
            </td>
            <td class="table-cell">{{ a.start_date }} {{ a.start_time }}</td>
            <td class="table-cell">{{ a.due_date }} {{ a.due_time }}</td>
            <td class="table-cell">{{ a.grade }}</td>
            <td class="table-cell">
              <a href="/pages/assignments/{{ a.id }}/stats?page={{ current_page }}&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}" class="file-link">Посмотреть статистику</a>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="5" class="no-assignments">Пока заданий нет.</td></tr>
        {% endif %}
      </tbody>
    </table>

    <!-- Пагинация -->
    <div class="pagination">
      {% if total_pages > 1 %}
        {% if current_page > 1 %}
          <a href="?page=1&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}">&laquo;</a>
          <a href="?page={{ current_page-1 }}&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}">&lt;</a>
        {% endif %}

        {% for p in range(1, total_pages+1) %}
          <a href="?page={{ p }}&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}" class="{% if p == current_page %}active{% endif %}">{{ p }}</a>
        {% endfor %}

        {% if current_page < total_pages %}
          <a href="?page={{ current_page+1 }}&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}">&gt;</a>
          <a href="?page={{ total_pages }}&sort={{ sort | trim }}{% if search %}&search={{ search }}{% endif %}">&raquo;</a>
        {% endif %}
      {% endif %}
    </div>
  </main>

  <footer class="footer">
    <div class="footer-container">
      <p>&copy; 2025 IPYNBGrader. Все права защищены.</p>
      <p class="mt-1">
        <a href="/pages/instructions" class="footer-link">Инструкция</a> |
        <a href="/docs" class="footer-link">API</a> |
        <a href="https://github.com/vlkttlv/autograder-ipynb" class="footer-link" target="_blank">GitHub</a>
      </p>
    </div>
  </footer>
  <script src="{{ url_for('static', path='js/logout.js') }}"></script>
</body>
</html>
