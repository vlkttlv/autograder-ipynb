<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заполните профиль</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="max-w-md mx-auto mt-20 bg-white p-6 rounded shadow">
    <h2 class="text-2xl font-semibold text-center mb-6">Заполните недостающие данные</h2>

    <form id="complete-form">
      <label class="block mb-2">Роль</label>
      <select id="role" name="role" class="w-full px-4 py-2 border rounded mb-4" required>
        <option value="STUDENT">Студент</option>
        <option value="TUTOR">Преподаватель</option>
      </select>

      <div id="group-container">
        <label for="group" class="block mb-2">Группа</label>
        <input type="text" id="group" name="group" class="w-full px-4 py-2 border rounded mb-4" placeholder="Например, 8В34">
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Сохранить
      </button>
    </form>
  </div>

<script>
  const roleSelect = document.getElementById('role');
  const groupContainer = document.getElementById('group-container');

  roleSelect.addEventListener('change', () => {
    groupContainer.style.display = roleSelect.value === 'STUDENT' ? 'block' : 'none';
  });

  document.getElementById('complete-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
      role: roleSelect.value,
      group: document.getElementById('group').value || null,
    };

    const res = await fetch('/auth/google/complete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });

    if (res.ok) {
      // выбираем страницу по роли
      const redirectUrl = data.role === 'TUTOR' ? '/pages/tutor-home' : '/pages/student-home';
      window.location.href = redirectUrl;
    } else {
      alert('Ошибка при сохранении данных');
    }
  });
</script>

</body>
</html>
