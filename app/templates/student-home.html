<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мои решения</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', path='css/student-home.css') }}">
  <script src="{{ url_for('static', path='js/script.js') }}" defer></script>
</head>
<body class="body-base">
  <nav class="nav-base">
    <div class="nav-title">IPYNBGrader</div>
    <div class="nav-actions">
      <a href="/pages/profile" class="home-link">Профиль</a>
      <a href="/pages/student-home" class="home-link">Домой</a>
      <form id="logout-form">
        <button type="submit" class="logout-button">Выйти</button>
      </form>
    </div>
  </nav>

  <main class="main-container">
    <h1 class="main-title">Мои решения</h1>
    <!-- Форма поиска и сортировки -->
    <form method="get" class="sort-form">
      <input type="hidden" name="sort" value="{{ sort }}">
      <input type="hidden" name="search" value="{{ search }}">
      <input type="hidden" name="page" value="{{ current_page }}">
      <label for="disciplineSelect">Дисциплина:</label>
      <select id="disciplineSelect" name="discipline_id" onchange="this.form.submit()">
        <option value="">Все дисциплины</option>
        {% for d in disciplines %}
          <option value="{{ d.id }}" {% if discipline_id == d.id %}selected{% endif %}>{{ d.name }}</option>
        {% endfor %}
      </select>
      <label for="sortSelect">Сортировка:</label>
      <select id="sortSelect" name="sort" onchange="this.form.submit()">
        <option value="newest" {% if sort | trim == 'newest' %}selected{% endif %}>Сначала новые</option>
        <option value="oldest" {% if sort | trim == 'oldest' %}selected{% endif %}>Сначала старые</option>
      </select>

      <input 
        type="text" 
        name="search" 
        placeholder="Поиск по названию..." 
        value="{{ search | default('') }}" 
        class="px-2 py-1 border rounded"
      >
      <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
        Найти
      </button>
    </form>

    <table class="assignment-table">
      <thead>
        <tr class="table-header">
          <th class="table-cell">Задание</th>
          <th class="table-cell">Попытки</th>
          <th class="table-cell">Оценка</th>
        </tr>
      </thead>
      <tbody>
        {% if submissions %}
          {% for s in submissions %}
          <tr class="table-row">
            <td class="table-cell">
              <a href="/pages/assignments/{{ s.assignment_id }}?page={{ current_page }}&sort={{ sort }}&search={{ search }}&discipline_id={{ discipline_id }}" class="assignment-link">{{ s.assignment.name }}</a>
           </td>
            <td class="table-cell">{{ s.number_of_attempts }}/{{ s.assignment.number_of_attempts }}</td>
            <td class="table-cell">{{ s.score or 0 }}/{{ s.assignment.grade }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="3" class="text-gray-500 text-center py-2">Пока решений нет.</td></tr>
        {% endif %}
      </tbody>
    </table>

    <!-- Пагинация -->
    <div class="pagination">
      {% if total_pages > 1 %}
        {% if current_page > 1 %}
          <a href="?page=1&sort={{ sort }}&search={{ search}}&discipline_id={{ discipline_id }}" class="">&laquo;</a>
          <a href="?page={{ current_page-1 }}&sort={{ sort }}&search={{ search}}&discipline_id={{ discipline_id }}" class="">&lt;</a>
        {% endif %}

        {% for p in range(1, total_pages+1) %}
          <a href="?page={{ p }}&sort={{ sort }}&search={{ search}}&discipline_id={{ discipline_id }}" class="{% if p == current_page %}active{% endif %}">{{ p }}</a>
        {% endfor %}

        {% if current_page < total_pages %}
          <a href="?page={{ current_page+1 }}&sort={{ sort }}&search={{ search}}&discipline_id={{ discipline_id }}" class="">&gt;</a>
          <a href="?page={{ total_pages }}&sort={{ sort }}&search={{ search}}&discipline_id={{ discipline_id }}" class="">&raquo;</a>
        {% endif %}
      {% endif %}
    </div>
  </main>

  <footer class="footer">
    <div class="footer-container">
      <p>&copy; 2025 IPYNBGrader. Все права защищены.</p>
      <p class="mt-1">
        <a href="/pages/instructions" class="footer-link">Инструкция</a> |
        <a href="/docs" class="footer-link">API</a> |
        <a href="https://github.com/vlkttlv/autograder-ipynb" class="footer-link" target="_blank">GitHub</a>
      </p>
    </div>
  </footer>
  <script src="{{ url_for('static', path='js/logout.js') }}"></script>
</body>
</html>