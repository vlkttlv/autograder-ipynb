<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Статистика: {{ assignment.name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="{{ url_for('static', path='css/stats.css') }}" rel="stylesheet">
  <script src="{{ url_for('static', path='js/script.js') }}" defer></script>
</head>
<body class="body-base">
  <nav class="nav-base">
    <div class="nav-title">IPYNBGrader</div>
    <div class="nav-actions">
      <a href="/pages/tutor-home" class="home-link">Домой</a>
      <form action="/auth/logout" method="post">
        <button class="logout-button">Выйти</button>
      </form>
    </div>
  </nav>

  <main class="main-container">
    <h1 class="main-title">Статистика по заданию: {{ assignment.name }}</h1>

    {% if statistics %}
      <h2 class="section-title">Средний балл по заданию: {{ avg_score }}</h2>
      <h2 class="section-title">Скачать в формате:<br>
        <a href="/assignments/{{ assignment.id }}/stats/download?method=csv" class="download-link" download>csv</a>
        <a href="/assignments/{{ assignment.id }}/stats/download?method=xlsx" class="download-link" download>xlsx</a>
      </h2>

      <table class="stats-table">
        <thead>
          <tr class="table-header">
            <th class="table-cell">Пользователь</th>
            <th class="table-cell">Кол-во попыток</th>
            <th class="table-cell">Баллы</th>
            <th class="table-cell"> </th>
          </tr>
        </thead>
        <tbody>
          {% for stat in statistics %}
          <tr class="table-row">
            <td class="table-cell">{{ stat.user.first_name }} {{ stat.user.last_name }} {{ stat.user.email }}</td>
            <td class="table-cell">{{ stat.number_of_attempts }}</td>
            <td class="table-cell">{{ stat.score }}</td>
            <td class="table-cell">
              <a href="/submissions/{{ stat.id }}/file?user_id={{ stat.user_id }}" class="download-link" download>Скачать решение</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="no-submissions">Нет отправленных решений</p>
    {% endif %}

    <div class="back-button-container flex justify-center gap-4 mt-8">
      <a href="/pages/assignments/{{ assignment.id }}" class="back-button">
        Вернуться к заданию
      </a>
      <a href="/pages/tutor-home?page={{ request.query_params.get('page', 1) }}" class="back-tutorhome-button">
        Вернуться к списку заданий
      </a>
    </div>
  </main>

  <footer class="bg-white border-t mt-12 py-4 text-center text-sm text-gray-500">
    <div class="max-w-6xl mx-auto px-4">
      <p>&copy; 2025 IPYNBGrader. Все права защищены.</p>
      <p class="mt-1">
        <a href="/pages/instructions" class="text-blue-600 hover:underline">Инструкция</a> |
        <a href="/docs" class="text-blue-600 hover:underline">API</a> |
        <a href="https://github.com/vlkttlv/autograder-ipynb" class="text-blue-600 hover:underline" target="_blank">GitHub</a>
      </p>
    </div>
  </footer>
</body>
</html>
